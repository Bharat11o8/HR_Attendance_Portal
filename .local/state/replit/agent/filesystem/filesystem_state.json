{"file_contents":{"app.py":{"content":"from flask import Flask, render_template, request, send_file\nfrom datetime import datetime, timedelta\nimport pandas as pd\nfrom io import BytesIO\nimport re\n\napp = Flask(__name__)\n\n# Hardcoded employee master data\nEMPLOYEE_MASTER = {\n    2: \"Rishi\",\n    3: \"Ankur Jain\",\n    4: \"Santosh Sharma\",\n    5: \"Gaurav\",\n    7: \"Gunjan\",\n    9: \"Aarti\",\n    10: \"Akansha Bajpai\",\n    11: \"Chirag Channa\",\n    14: \"Sumit\",\n    15: \"Sanjay Dwivedi\",\n    17: \"Himanshu Gandhi\",\n    19: \"Sandhya Jha\",\n    20: \"Vijaya\",\n    26: \"Saurabh\",\n    31: \"Anshika Singh\",\n    34: \"Pankaj Vij\",\n    35: \"Kiran\",\n    36: \"Hardevi\",\n    37: \"Sadhana\",\n    38: \"Kanchani\",\n    32: \"Prabhat\",\n    40: \"Naman\",\n    41: \"Ashish Rai\",\n    42: \"Bharat Maheshwari\"\n}\n\ndef parse_biometric_file(file_content):\n    \"\"\"Parse the biometric .txt file\"\"\"\n    # Try different encodings\n    encodings = ['utf-8', 'utf-16', 'utf-16-le', 'utf-16-be', 'latin-1', 'cp1252']\n    lines = None\n    \n    for encoding in encodings:\n        try:\n            lines = file_content.decode(encoding).strip().split('\\n')\n            break\n        except (UnicodeDecodeError, AttributeError):\n            continue\n    \n    if lines is None:\n        raise ValueError(\"Unable to decode file. Please ensure it's a valid text file.\")\n    \n    # Skip header line\n    data_lines = lines[1:]\n    \n    records = []\n    for line_num, line in enumerate(data_lines, start=2):\n        if not line.strip():\n            continue\n        \n        # Try different splitting methods\n        parts = None\n        \n        # First try tab-separated\n        if '\\t' in line:\n            parts = [p.strip() for p in line.split('\\t') if p.strip()]\n        else:\n            # Try splitting by multiple spaces\n            parts = re.split(r'\\s{2,}', line.strip())\n        \n        if len(parts) >= 3:\n            try:\n                en_no = None\n                date_time_str = None\n                \n                # Look for employee number in zero-padded format (e.g., '00000020')\n                for part in parts:\n                    if en_no is None and re.match(r'^0+\\d+$', part):\n                        en_no = int(part)\n                \n                # Look for datetime pattern in the line itself (might not be in parts array)\n                datetime_match = re.search(r'(\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2})', line)\n                if datetime_match:\n                    date_time_str = datetime_match.group(1)\n                \n                if en_no and date_time_str:\n                    # Parse datetime\n                    dt = datetime.strptime(date_time_str, '%Y-%m-%d %H:%M:%S')\n                    \n                    records.append({\n                        'EnNo': en_no,\n                        'DateTime': dt,\n                        'Date': dt.date(),\n                        'Time': dt.time()\n                    })\n            except (ValueError, IndexError) as e:\n                continue\n    \n    return records\n\ndef process_attendance(records, start_date, end_date):\n    \"\"\"Process attendance records and generate output\"\"\"\n    \n    # Filter records by date range and employee list\n    filtered_records = [\n        r for r in records \n        if r['EnNo'] in EMPLOYEE_MASTER \n        and start_date <= r['Date'] <= end_date\n    ]\n    \n    # Group by employee and date\n    attendance_dict = {}\n    for record in filtered_records:\n        key = (record['EnNo'], record['Date'])\n        if key not in attendance_dict:\n            attendance_dict[key] = {'in_times': [], 'out_times': []}\n        \n        attendance_dict[key]['in_times'].append(record['DateTime'])\n        attendance_dict[key]['out_times'].append(record['DateTime'])\n    \n    # Calculate earliest IN and latest OUT for each day\n    daily_attendance = {}\n    for (en_no, date), times in attendance_dict.items():\n        in_time = min(times['in_times']).time()\n        out_time = max(times['out_times']).time()\n        daily_attendance[(en_no, date)] = {'in': in_time, 'out': out_time}\n    \n    # Generate output for all employees and all dates\n    output_data = []\n    current_date = start_date\n    date_range = []\n    \n    while current_date <= end_date:\n        date_range.append(current_date)\n        current_date += timedelta(days=1)\n    \n    for emp_id in sorted(EMPLOYEE_MASTER.keys()):\n        emp_name = EMPLOYEE_MASTER[emp_id]\n        \n        for date in date_range:\n            key = (emp_id, date)\n            \n            if key in daily_attendance:\n                in_time = daily_attendance[key]['in']\n                out_time = daily_attendance[key]['out']\n                \n                # Check if late (after 9:30 AM)\n                late_threshold = datetime.strptime('09:30:00', '%H:%M:%S').time()\n                remark = 'Late' if in_time > late_threshold else ''\n                \n                # Calculate late duration\n                late_by = ''\n                if in_time > late_threshold:\n                    # Convert times to datetime for calculation\n                    in_datetime = datetime.combine(date, in_time)\n                    threshold_datetime = datetime.combine(date, late_threshold)\n                    late_duration = in_datetime - threshold_datetime\n                    \n                    # Convert to hours, minutes, and seconds\n                    total_seconds = int(late_duration.total_seconds())\n                    hours = total_seconds // 3600\n                    minutes = (total_seconds % 3600) // 60\n                    seconds = total_seconds % 60\n                    \n                    # Build the late_by string\n                    parts = []\n                    if hours > 0:\n                        parts.append(f\"{hours} hr\")\n                    if minutes > 0:\n                        parts.append(f\"{minutes} mins\")\n                    if seconds > 0 or len(parts) == 0:\n                        parts.append(f\"{seconds} secs\")\n                    \n                    late_by = \" \".join(parts)\n                \n                in_str = in_time.strftime('%H:%M:%S')\n                out_str = out_time.strftime('%H:%M:%S')\n            else:\n                in_str = ''\n                out_str = ''\n                remark = ''\n                late_by = ''\n            \n            output_data.append({\n                'ID': emp_id,\n                'Name': emp_name,\n                'Date': date.strftime('%Y-%m-%d'),\n                'IN': in_str,\n                'OUT': out_str,\n                'Remark': remark,\n                'Late By': late_by\n            })\n    \n    return output_data\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/process', methods=['POST'])\ndef process():\n    try:\n        # Get uploaded file\n        biometric_file = request.files['biometric_file']\n        \n        # Get date range\n        start_date_str = request.form['start_date']\n        end_date_str = request.form['end_date']\n        \n        start_date = datetime.strptime(start_date_str, '%Y-%m-%d').date()\n        end_date = datetime.strptime(end_date_str, '%Y-%m-%d').date()\n        \n        # Parse biometric data\n        file_content = biometric_file.read()\n        records = parse_biometric_file(file_content)\n        \n        # Process attendance\n        output_data = process_attendance(records, start_date, end_date)\n        \n        # Create Excel file\n        df = pd.DataFrame(output_data)\n        \n        output = BytesIO()\n        with pd.ExcelWriter(output, engine='openpyxl') as writer:\n            df.to_excel(writer, index=False, sheet_name='Attendance')\n        \n        output.seek(0)\n        \n        filename = f'Attendance_{start_date_str}_to_{end_date_str}.xlsx'\n        \n        return send_file(\n            output,\n            mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n            as_attachment=True,\n            download_name=filename\n        )\n    \n    except Exception as e:\n        return f\"Error processing file: {str(e)}\", 400\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000, debug=True)\n","size_bytes":8088},"attached_assets/hr_attendance_portal_1763463296830.py":{"content":"from flask import Flask, render_template, request, send_file\nfrom datetime import datetime, timedelta\nimport pandas as pd\nfrom io import BytesIO\nimport re\n\napp = Flask(__name__)\n\n# Hardcoded employee master data\nEMPLOYEE_MASTER = {\n    2: \"Rishi\",\n    3: \"Ankur Jain\",\n    4: \"Sahtosh Sharma\",\n    5: \"Gaurav\",\n    7: \"Gunjan\",\n    9: \"Aarti\",\n    10: \"Akansha Bajpai\",\n    11: \"Chirag Channa\",\n    14: \"Sumit\",\n    15: \"Sanjay Dwivedi\",\n    17: \"Himanshu Gandhi\",\n    19: \"Sandhya Jha\",\n    20: \"Vijaya\",\n    26: \"Saurabh\",\n    31: \"Anshika Singh\",\n    34: \"Pankaj Vij\",\n    35: \"Kiran\",\n    36: \"Hardevi\",\n    37: \"Sadhana\",\n    38: \"Kanchani\",\n    32: \"Prabhat\",\n    40: \"Naman\",\n    41: \"Ashish Rai\",\n    42: \"Bharat\"\n}\n\ndef parse_biometric_file(file_content):\n    \"\"\"Parse the biometric .txt file\"\"\"\n    lines = file_content.decode('utf-8').strip().split('\\n')\n    \n    # Skip header line\n    data_lines = lines[1:]\n    \n    records = []\n    for line in data_lines:\n        if not line.strip():\n            continue\n        \n        # Split by tabs or multiple spaces\n        parts = re.split(r'\\t+|\\s{2,}', line.strip())\n        \n        if len(parts) >= 10:\n            try:\n                en_no = int(parts[2])  # EnNo column\n                date_time_str = parts[9]  # DateTime column\n                \n                # Parse datetime\n                dt = datetime.strptime(date_time_str, '%Y-%m-%d %H:%M:%S')\n                \n                records.append({\n                    'EnNo': en_no,\n                    'DateTime': dt,\n                    'Date': dt.date(),\n                    'Time': dt.time()\n                })\n            except (ValueError, IndexError):\n                continue\n    \n    return records\n\ndef process_attendance(records, start_date, end_date):\n    \"\"\"Process attendance records and generate output\"\"\"\n    \n    # Filter records by date range and employee list\n    filtered_records = [\n        r for r in records \n        if r['EnNo'] in EMPLOYEE_MASTER \n        and start_date <= r['Date'] <= end_date\n    ]\n    \n    # Group by employee and date\n    attendance_dict = {}\n    for record in filtered_records:\n        key = (record['EnNo'], record['Date'])\n        if key not in attendance_dict:\n            attendance_dict[key] = {'in_times': [], 'out_times': []}\n        \n        attendance_dict[key]['in_times'].append(record['DateTime'])\n        attendance_dict[key]['out_times'].append(record['DateTime'])\n    \n    # Calculate earliest IN and latest OUT for each day\n    daily_attendance = {}\n    for (en_no, date), times in attendance_dict.items():\n        in_time = min(times['in_times']).time()\n        out_time = max(times['out_times']).time()\n        daily_attendance[(en_no, date)] = {'in': in_time, 'out': out_time}\n    \n    # Generate output for all employees and all dates\n    output_data = []\n    current_date = start_date\n    date_range = []\n    \n    while current_date <= end_date:\n        date_range.append(current_date)\n        current_date += timedelta(days=1)\n    \n    for emp_id in sorted(EMPLOYEE_MASTER.keys()):\n        emp_name = EMPLOYEE_MASTER[emp_id]\n        \n        for date in date_range:\n            key = (emp_id, date)\n            \n            if key in daily_attendance:\n                in_time = daily_attendance[key]['in']\n                out_time = daily_attendance[key]['out']\n                \n                # Check if late (after 9:30 AM)\n                late_threshold = datetime.strptime('09:30:00', '%H:%M:%S').time()\n                remark = 'Late' if in_time > late_threshold else ''\n                \n                in_str = in_time.strftime('%H:%M:%S')\n                out_str = out_time.strftime('%H:%M:%S')\n            else:\n                in_str = ''\n                out_str = ''\n                remark = ''\n            \n            output_data.append({\n                'ID': emp_id,\n                'Name': emp_name,\n                'Date': date.strftime('%Y-%m-%d'),\n                'IN': in_str,\n                'OUT': out_str,\n                'Remark': remark\n            })\n    \n    return output_data\n\n@app.route('/')\ndef index():\n    return render_template('index.html')\n\n@app.route('/process', methods=['POST'])\ndef process():\n    try:\n        # Get uploaded file\n        biometric_file = request.files['biometric_file']\n        \n        # Get date range\n        start_date_str = request.form['start_date']\n        end_date_str = request.form['end_date']\n        \n        start_date = datetime.strptime(start_date_str, '%Y-%m-%d').date()\n        end_date = datetime.strptime(end_date_str, '%Y-%m-%d').date()\n        \n        # Parse biometric data\n        file_content = biometric_file.read()\n        records = parse_biometric_file(file_content)\n        \n        # Process attendance\n        output_data = process_attendance(records, start_date, end_date)\n        \n        # Create Excel file\n        df = pd.DataFrame(output_data)\n        \n        output = BytesIO()\n        with pd.ExcelWriter(output, engine='openpyxl') as writer:\n            df.to_excel(writer, index=False, sheet_name='Attendance')\n        \n        output.seek(0)\n        \n        filename = f'Attendance_{start_date_str}_to_{end_date_str}.xlsx'\n        \n        return send_file(\n            output,\n            mimetype='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\n            as_attachment=True,\n            download_name=filename\n        )\n    \n    except Exception as e:\n        return f\"Error processing file: {str(e)}\", 400\n\nif __name__ == '__main__':\n    app.run(host='0.0.0.0', port=5000, debug=True)","size_bytes":5605},"pyproject.toml":{"content":"[project]\nname = \"python-template\"\nversion = \"0.1.0\"\ndescription = \"\"\nauthors = [\"Your Name <you@example.com>\"]\nrequires-python = \">=3.11\"\ndependencies = [\n    \"flask>=3.1.2\",\n    \"openpyxl==3.1.2\",\n    \"pandas>=2.3.3\",\n]\n","size_bytes":222},"main.py":{"content":"","size_bytes":0}},"version":2}